!function(e){var t={};function o(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(s,r,function(t){return e[t]}.bind(null,r));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t);const{createElement:s,render:r,useState:n,useEffect:a,Fragment:l}=wp.element,{select:i,dispatch:u}=wp.data;var c=e=>{const[t,o]=n(!1),[r,i]=n(!1),[c,d]=n(!1);a(()=>{localforage.getItem("bp_login_token").then(e=>{e&&d(e)})},[]),a(()=>{o(!0)},[e,c]);let p={};return r&&(p={opacity:"0.5","pointer-events":"none"}),s(l,null,t?s("div",{className:"popup_wrapper",onClick:e=>{e.preventDefault(),document.querySelector(".popup_wrapper")&&e.target===document.querySelector(".popup_wrapper")&&o(!1)}},s("div",{className:"popup_content"},s("span",{className:"vicon vicon-close",onClick:()=>{o(!1)}}),s("h3",null,window.wplms_course_data.translations.apply_to_course),s("div",{className:"popup-footer"},s("a",{className:"button is-primary",style:p,onClick:()=>{i(!0),fetch(window.wplms_course_data.api_url+"/student/courseButton/applycourse",{method:"post",body:JSON.stringify({id:e.id,token:c})}).then(e=>e.ok?e.json():{status:0,message:window.wplms_course_data.translations.error_loading_data}).then(t=>{if(t.status){o(!1),i(!1);var s=new CustomEvent("wplms_popup_applied",{detail:{course:e.id,text:t.message}});document.dispatchEvent(s)}}).catch(e=>{i(!1),console.error("Uh oh, an error!",e),u("vibebp").addNotification({text:window.wplms_course_data.translations.error_loading_data})})}},window.wplms_course_data.translations.yes),s("a",{className:"button is-primary",onClick:()=>{o(!1)}},window.wplms_course_data.translations.cancel)))):"")};const{createElement:d,render:p,useState:_,useEffect:m,Fragment:h}=wp.element,{select:w,dispatch:f}=wp.data,g=e=>{const[t,o]=_(!1),[s,r]=_(!0),[n,a]=_(window.wplms_course_data.translations.take_this_course),[l,i]=_(""),[u,c]=_(""),[p,w]=_([]),[g,b]=_(!1),[y,v]=_({}),[k,N]=_(!1),[S,L]=_(!1),[E,O]=_(!1),[x,P]=_(-1);m(()=>{localforage.getItem("bp_login_token").then(e=>{o(e)})},[]),m(()=>{document.addEventListener("wplms_popup_applied",t=>{t.detail.course==e.id&&t.detail.hasOwnProperty("text")&&(b(!1),i("#"),a(t.detail.text))},!1),document.addEventListener("reload_course_button",t=>{t.detail.course==e.id&&A(!0)},!1)},[]),m(()=>{A()},[e,t]),m(()=>{if(S){var t=new CustomEvent("wplms_popup_clicked",{detail:{course:e.id}});document.dispatchEvent(t),L(!1)}},[S]);const A=(o=null)=>{if(r(!0),t)if(N(!1),!o&&e.hasOwnProperty("coursedata")&&e.coursedata){let t=e.coursedata;t.status&&("#apply"==t.link&&b(!0),a(t.text),t.hasOwnProperty("error")?v(t.error):(i(t.link),t.hasOwnProperty("form")&&c(t.form),P(t.course_status)),w(t.extras)),t.hasOwnProperty("hide_button")&&t.hide_button&&N(!0),t.hasOwnProperty("is_free")&&t.is_free&&O(!0),r(!1)}else fetch(`${window.wplms_course_data.api_url}/student/courseButton/?course=${e.id}&force`,{method:"post",body:JSON.stringify({id:e.id,token:t,price:window.wplms_course_data.show_price})}).then(e=>e.ok?e.json():{status:0,message:window.wplms_course_data.translations.error_loading_data}).then(e=>{e.status&&("#apply"==e.link&&b(!0),a(e.text),e.hasOwnProperty("error")?v(e.error):(i(e.link),e.hasOwnProperty("form")&&c(e.form),P(e.course_status)),w(e.extras)),e.hasOwnProperty("hide_button")&&e.hide_button&&N(!0),e.hasOwnProperty("is_free")&&e.is_free&&O(!0),r(!1)}).catch(e=>{r(!1),console.error("Uh oh, an error!",e),f("vibebp").addNotification({text:window.wplms_course_data.translations.error_loading_data})})},q=(t,o)=>{var s=new CustomEvent("coursebuttonpricingclicked",{detail:{original_event:t,course:e.id,price:o}});document.dispatchEvent(s)};return k?"":s?d("span",{className:"course_button button full is-loading"},"..."):d(h,null,g?d("span",{className:"the_course_button"},d("a",{href:l,className:"course_button button full",onClick:e=>{e.preventDefault(),L(!0)}},d("span",{dangerouslySetInnerHTML:{__html:n}}),p.length?p.map(e=>d("span",null,e)):"")):u.length?d("div",{className:" the_course_button"},d("form",{action:u,className:"",method:"post"},d("input",{type:"hidden",name:"token",value:t}),d("input",{type:"hidden",name:"course_id",value:e.id}),d("button",{type:"submit",className:"button full course_button"},d("span",{dangerouslySetInnerHTML:{__html:n}}),p.length?p.map(e=>d("span",null,e)):""))):d(h,null,d("div",{className:"the_course_button"},Array.isArray(l)&&l.length?d("div",{className:"course_button button full"},d("a",{href:l[0].link,onClick:e=>{q(e,l[0])}},d("strong",null,n||window.wplms_course_data.translations.take_this_course),d("span",{dangerouslySetInnerHTML:{__html:l[0].price}})),l.length>1?d(h,null,d("input",{id:"course_price",type:"checkbox"}),d("label",{for:"course_price",class:"vicon vicon-angle-down"}),d("div",{className:"wplms_price_dropdown"},l.map(e=>d("a",{href:e.link,dangerouslySetInnerHTML:{__html:e.price},onClick:t=>{q(t,e)}})))):"",p.length?d("div",{className:"extra_details"},p.map(e=>d("span",{dangerouslySetInnerHTML:{__html:e}}))):""):x<0&&E?d("a",{href:l,className:"course_button button full",onClick:o=>{o.preventDefault(),r(!0),fetch(window.wplms_course_data.api_url+"/user/subscribe?post",{method:"post",body:JSON.stringify({course_id:e.id,token:t})}).then(e=>e.json()).then(e=>{e.status&&A(!0),e.hasOwnProperty("message")&&e.message&&e.message.length&&f("vibebp").addNotification({text:e.message}),r(!1)})}},d("strong",null,n&&n.length?n:window.wplms_course_data.translations.take_this_course),p.length?d("div",{className:"extra_details"},p.map(e=>d("span",null,e))):""):d("a",{href:l,className:"course_button button full",onClick:e=>{q(e,l)}},n||window.wplms_course_data.translations.take_this_course,p.length?d("div",{className:"extra_details"},p.map(e=>d("span",{dangerouslySetInnerHTML:{__html:e}}))):"")),y&&y.hasOwnProperty("error_message")?d("div",{className:"vbp_message error"},d("span",{className:"vicon "+y.icon,style:{margin:"0 0.2rem"}}),d("span",{dangerouslySetInnerHTML:{__html:y.error_message}})):""))},b=()=>{"undefined"!=typeof localforage&&localforage.getItem("bp_login_token").then(e=>{if(e){let t=[];document.querySelectorAll(".the_course_button").forEach(e=>{e.classList.add("is-loading"),t.push(e.getAttribute("data-id"))}),t.length?fetch(`${window.wplms_course_data.api_url}/student/courseButtons/?courses=${JSON.stringify(t)}&force`,{method:"post",body:JSON.stringify({ids:t,token:e,price:window.wplms_course_data.show_price})}).then(e=>e.ok?e.json():{status:0,message:window.wplms_course_data.translations.error_loading_data}).then(e=>{e.status&&Object.keys(e.courses).length?document.querySelectorAll(".the_course_button").forEach(t=>{t.classList.remove("is-loading");let o=t.getAttribute("data-id");e.courses.hasOwnProperty(o)&&p(d(g,{id:o,def:t.innerHTML,coursedata:e.courses[o]}),t)}):(document.querySelectorAll(".the_course_button").forEach(e=>{e.classList.remove("is-loading")}),f("vibebp").addNotification({text:window.wplms_course_data.translations.error_loading_data}))}).catch(e=>{setIsLoading(!1),console.error("Uh oh, an error!",e),f("vibebp").addNotification({text:window.wplms_course_data.translations.error_loading_data})}):document.querySelectorAll(".the_course_button").forEach(e=>{e.classList.remove("is-loading"),e.querySelector(".course_button")&&e.querySelector(".course_button").classList.remove("is-loading")})}else document.querySelectorAll(".the_course_button").forEach(e=>{e.classList.remove("is-loading"),e.querySelector(".course_button")&&e.querySelector(".course_button").classList.remove("is-loading")})})},y=()=>{let e=[];if(document.querySelectorAll(".the_course_button").forEach(t=>{t.classList.add("is-loading"),e.push(t.getAttribute("data-id"))}),!e.length)return document.removeEventListener("userLoaded",y,!1),void document.querySelectorAll(".the_course_button").forEach(e=>{e.classList.remove("is-loading")});fetch(`${window.wplms_course_data.api_url}/student/courseButtons/?courses=${JSON.stringify(e)}&force`,{method:"post",body:JSON.stringify({ids:e,token:w("vibebp").getToken(),price:window.wplms_course_data.show_price})}).then(e=>e.ok?e.json():{status:0,message:window.wplms_course_data.translations.error_loading_data}).then(e=>{e.status&&Object.keys(e.courses).length?document.querySelectorAll(".the_course_button").forEach(t=>{t.classList.remove("is-loading");let o=t.getAttribute("data-id");e.courses.hasOwnProperty(o)&&p(d(g,{id:o,def:t.innerHTML,coursedata:e.courses[o]}),t)}):(document.querySelectorAll(".the_course_button").forEach(e=>{e.classList.remove("is-loading")}),f("vibebp").addNotification({text:window.wplms_course_data.translations.error_loading_data}))}).catch(e=>{setIsLoading(!1),console.error("Uh oh, an error!",e),f("vibebp").addNotification({text:window.wplms_course_data.translations.error_loading_data})}),document.removeEventListener("userLoaded",y,!1)};document.addEventListener("userLoaded",y,!1),document.addEventListener("course_cards_loaded",b,!1),document.addEventListener("single_course_loaded",b,!1),document.addEventListener("DOMContentLoaded",b,!1),document.addEventListener("wplms_popup_clicked",e=>{null!==document.getElementById("wplms_popup")&&document.getElementById("wplms_popup").remove();let t=document.createElement("div");t.setAttribute("id","wplms_popup"),document.body.appendChild(t),p(d(c,{id:e.detail.course}),document.getElementById("wplms_popup"))},!1)}]);